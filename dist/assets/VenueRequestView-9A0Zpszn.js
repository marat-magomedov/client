import{d as se,m as B,y as ae,h as i,I as le,n as oe,c as u,a as e,b as d,s as v,f as a,t as s,k as D,v as E,w as p,e as de,F as G,p as U,T as R,J as A,q as S,g as L,i as y,j as ne,x as ie,o as l}from"./index-5LzwdxIU.js";import{a as ue,b as ce,r as P}from"./SunIcon-CQ8JlxoV.js";import{r as J}from"./ArrowPathIcon-BzINURJv.js";import{r as ge,a as be}from"./MagnifyingGlassIcon-BsEnmBQm.js";import{I as pe,j as xe,r as he,A as ve,F as O}from"./listbox-hzFaL_w_.js";import{r as Q}from"./CheckIcon-v2Fs6tEk.js";import{r as ye}from"./CheckCircleIcon-BJ3MrFaD.js";const me={class:"min-h-screen bg-light-bg dark:bg-gray-900 flex flex-col"},fe={class:"flex-1 container mx-auto px-4 py-8 md:py-12"},ke={class:"max-w-7xl mx-auto"},_e={class:"flex justify-between items-center mb-6 md:mb-10"},we={key:0,class:"text-center p-8 bg-light-bg-secondary dark:bg-gray-800/40 rounded-2xl border border-light-border dark:border-gray-700/30"},Ce={class:"inline-flex items-center gap-3 text-light-text-secondary dark:text-gray-400"},Te={key:1,class:"mb-6 p-4 bg-red-400/10 rounded-xl border border-red-400/30 text-red-400"},$e={key:2,class:"p-8 bg-light-bg-secondary dark:bg-gray-800/40 rounded-2xl border border-light-border dark:border-gray-700/30 text-light-text-secondary dark:text-gray-400 text-center"},Ve={key:3,class:"space-y-8"},je={class:"bg-light-bg-secondary dark:bg-gray-800/40 backdrop-blur-lg p-6 rounded-2xl border border-light-border dark:border-gray-700/30 shadow-xl relative z-10"},qe={class:"grid md:grid-cols-2 gap-4"},ze={class:"relative"},Re={class:"relative"},Se={class:"relative z-[999]"},Le={class:"block truncate"},Me={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},Ne={class:"bg-light-bg-secondary dark:bg-gray-800/40 backdrop-blur-lg rounded-2xl border border-light-border dark:border-gray-700/30 shadow-xl overflow-hidden z-0 relative"},Fe={class:"grid gap-2 p-4"},Ie={class:"md:hidden p-4 space-y-4"},Be={class:"flex items-center gap-4"},De={class:"relative flex-shrink-0 w-16 h-16"},Ee=["src","alt"],Ge={class:"flex-1 min-w-0"},Ue={class:"font-medium text-light-text dark:text-gray-100 truncate"},Ae={class:"text-sm text-light-text-secondary dark:text-gray-400"},Pe={class:"flex items-center justify-between"},Je={class:"px-3 py-1 bg-light-bg dark:bg-gray-800/50 rounded-full text-sm text-purple-400 border border-purple-400/20"},Oe={class:"text-green-400 font-medium"},Qe=["onClick"],He={class:"hidden md:grid grid-cols-12 gap-4 items-center p-4"},Ke={class:"col-span-5"},We={class:"flex items-center gap-4"},Xe={class:"relative flex-shrink-0 w-12 h-12"},Ye=["src","alt"],Ze={class:"font-medium text-light-text dark:text-gray-100"},et={class:"text-sm text-light-text-secondary dark:text-gray-400"},tt={class:"col-span-2"},rt={class:"px-3 py-1 bg-light-bg dark:bg-gray-800/50 rounded-full text-sm text-purple-400 border border-purple-400/20"},st={class:"col-span-2 text-green-400 font-medium"},at={class:"col-span-3 text-right"},lt=["onClick"],ot={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50"},dt={class:"bg-light-bg-secondary dark:bg-gray-800/95 backdrop-blur-lg p-8 rounded-2xl border border-light-border dark:border-gray-700/30 shadow-2xl max-w-md w-full"},nt={class:"text-xl font-bold text-light-text dark:text-gray-200 mb-4 truncate"},it=["min","placeholder"],ut={class:"flex flex-col sm:flex-row gap-4"},ct=["disabled"],gt={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50"},bt={class:"bg-light-bg-secondary dark:bg-gray-800/95 backdrop-blur-lg p-8 rounded-2xl border border-light-border dark:border-gray-700/30 shadow-2xl max-w-md w-full"},pt={class:"text-center mb-6"},xt={class:"space-y-4 mb-6"},ht={class:"p-4 bg-light-bg dark:bg-gray-900/20 rounded-xl"},vt={class:"text-light-text dark:text-gray-100 font-medium truncate"},yt={class:"text-sm text-light-text-secondary dark:text-gray-400"},mt={class:"grid grid-cols-2 gap-4"},ft={class:"p-3 bg-light-bg dark:bg-gray-900/20 rounded-lg"},kt={class:"text-green-400 font-medium"},_t={class:"p-3 bg-light-bg dark:bg-gray-900/20 rounded-lg"},wt={class:"flex flex-col gap-3"},St=se({__name:"VenueRequestView",setup(Ct){const H=ae(),K=ie(),M=B(()=>Number(H.params.id)),C=i([]),V=i([]),j=i(!1),m=i(null),f=i(""),x=i(null),q=i([]),T=i(!1),b=i(null),h=i(0),k=i(!1),z=i(!1),c=i(null),N=le(),W=B(()=>N.isDark);function X(){N.toggleTheme()}async function Y(){var n,r;try{j.value=!0,m.value=null;const t=await A.get(`http://127.0.0.1:8000/api/venue/${M.value}/tracks/`);C.value=t.data,q.value=t.data;const o={};C.value.forEach(g=>{o[g.genre.id]=g.genre}),V.value=Object.values(o)}catch(t){console.error("Error fetching tracks:",t),m.value=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.detail)||"Ошибка при загрузке треков"}finally{j.value=!1}}function F(){q.value=C.value.filter(n=>{const r=!f.value||n.title.toLowerCase().includes(f.value.toLowerCase())||n.artist.toLowerCase().includes(f.value.toLowerCase()),t=!x.value||n.genre.id===x.value;return r&&t})}function I(n){b.value=n,h.value=n.price,T.value=!0}function Z(){b.value=null,h.value=0,T.value=!1}async function ee(){var n,r;if(b.value)try{k.value=!0;const t=await A.post(`http://127.0.0.1:8000/api/venue/${M.value}/request/`,{track:b.value.id,user_fee:h.value});c.value=t.data,T.value=!1,z.value=!0}catch(t){console.error("Error creating track request:",t),m.value=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.detail)||"Ошибка при создании запроса на трек"}finally{k.value=!1}}function te(){c.value&&K.push(`/request/pay/${c.value.payment_token}`)}function re(){z.value=!1,c.value=null}return oe(()=>{Y()}),(n,r)=>(l(),u("div",me,[e("main",fe,[e("div",ke,[e("div",_e,[r[3]||(r[3]=e("h1",{class:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-purple-400 via-blue-400 to-cyan-400 bg-clip-text text-transparent animate-fade-in"}," Заказ трека ",-1)),e("button",{onClick:X,class:"p-2 rounded-xl bg-light-bg-secondary dark:bg-gray-800/40 border border-light-border dark:border-gray-700/30 text-light-text-secondary dark:text-gray-400 hover:bg-light-bg dark:hover:bg-gray-700/40 transition-all"},[W.value?(l(),v(a(ue),{key:0,class:"w-6 h-6"})):(l(),v(a(ce),{key:1,class:"w-6 h-6"}))])]),j.value?(l(),u("div",we,[e("div",Ce,[d(a(J),{class:"w-6 h-6 animate-spin-once"}),r[4]||(r[4]=e("span",null,"Загрузка треков...",-1))])])):m.value?(l(),u("div",Te,s(m.value),1)):C.value.length===0?(l(),u("div",$e," В этом заведении нет доступных треков ")):(l(),u("div",Ve,[e("div",je,[e("div",qe,[e("div",ze,[d(a(ge),{class:"w-5 h-5 absolute left-3 top-3.5 text-light-text-secondary dark:text-gray-400 z-10"}),D(e("input",{id:"search",type:"text","onUpdate:modelValue":r[0]||(r[0]=t=>f.value=t),onInput:F,placeholder:"Поиск по названию или исполнителю",class:"w-full pl-10 pr-4 py-2.5 text-light-text dark:text-white bg-light-bg dark:bg-gray-900/20 border border-light-border dark:border-gray-700/30 rounded-xl focus:border-purple-400/50 focus:ring-2 focus:ring-purple-400/20 transition-all"},null,544),[[E,f.value]])]),e("div",Re,[d(a(be),{class:"w-5 h-5 absolute left-3 top-3.5 text-light-text-secondary dark:text-gray-400 z-10"}),e("div",Se,[d(a(pe),{modelValue:x.value,"onUpdate:modelValue":[r[1]||(r[1]=t=>x.value=t),F]},{default:p(()=>[d(a(xe),{class:"w-full pl-10 pr-4 py-2.5 text-left text-light-text dark:text-white bg-light-bg dark:bg-gray-900/20 border border-light-border dark:border-gray-700/30 rounded-xl focus:border-purple-400/50 focus:ring-2 focus:ring-purple-400/20 appearance-none transition-all"},{default:p(()=>{var t;return[e("span",Le,s(x.value?(t=V.value.find(o=>o.id===x.value))==null?void 0:t.name:"Все жанры"),1),e("span",Me,[d(a(he),{class:"h-5 w-5 text-light-text-secondary dark:text-gray-400","aria-hidden":"true"})])]}),_:1}),d(R,{"leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:p(()=>[d(a(ve),{class:"absolute z-[9999] mt-1 max-h-60 w-full overflow-auto rounded-xl bg-light-bg-secondary dark:bg-gray-800/95 backdrop-blur-lg py-1 text-base shadow-lg border border-light-border dark:border-gray-700/30 focus:outline-none"},{default:p(()=>[d(a(O),{value:null,class:"relative cursor-pointer select-none"},{default:p(({active:t,selected:o})=>[e("span",{class:S([t?"bg-purple-400/20 text-light-text dark:text-white":"text-light-text-secondary dark:text-gray-300","block truncate px-4 py-2"])},[r[5]||(r[5]=L(" Все жанры ")),x.value===null?(l(),v(a(Q),{key:0,class:"h-5 w-5 inline-block ml-2 text-purple-400","aria-hidden":"true"})):y("",!0)],2)]),_:1}),(l(!0),u(G,null,U(V.value,t=>(l(),v(a(O),{key:t.id,value:t.id,class:"relative cursor-pointer select-none"},{default:p(({active:o,selected:g})=>[e("span",{class:S([o?"bg-purple-400/20 text-light-text dark:text-white":"text-light-text-secondary dark:text-gray-300","block truncate px-4 py-2"])},[L(s(t.name)+" ",1),g?(l(),v(a(Q),{key:0,class:"h-5 w-5 inline-block ml-2 text-purple-400","aria-hidden":"true"})):y("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),e("div",Ne,[r[10]||(r[10]=de('<div class="hidden md:grid grid-cols-12 gap-4 px-6 py-4 bg-light-bg dark:bg-gray-900/30 border-b border-light-border dark:border-gray-700/30"><div class="col-span-5 text-light-text-secondary dark:text-gray-400 font-medium">Трек</div><div class="col-span-2 text-light-text-secondary dark:text-gray-400 font-medium">Жанр</div><div class="col-span-2 text-light-text-secondary dark:text-gray-400 font-medium">Цена</div><div class="col-span-3"></div></div>',1)),e("div",Fe,[(l(!0),u(G,null,U(q.value,t=>(l(),u("div",{key:t.id,class:"group bg-light-bg dark:bg-gray-900/20 hover:bg-light-bg-secondary dark:hover:bg-gray-800/40 rounded-xl border border-light-border dark:border-gray-700/30 hover:border-purple-400/30 transition-all"},[e("div",Ie,[e("div",Be,[e("div",De,[e("img",{src:t.icon,alt:t.title,class:"w-full h-full rounded-xl object-cover border border-light-border dark:border-gray-700/30 shadow-lg"},null,8,Ee),r[6]||(r[6]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-gray-900/60 to-transparent rounded-xl"},null,-1)),d(a(P),{class:"absolute bottom-2 right-2 w-4 h-4 text-purple-400"})]),e("div",Ge,[e("h3",Ue,s(t.title),1),e("p",Ae,s(t.artist),1)])]),e("div",Pe,[e("span",Je,s(t.genre.name),1),e("span",Oe,s(t.price)+" ₽",1)]),e("button",{onClick:o=>I(t),class:"w-full py-2 bg-purple-400/10 hover:bg-purple-400/20 border border-purple-400/30 rounded-lg transition-all"},r[7]||(r[7]=[e("span",{class:"text-purple-400 group-hover:text-purple-300"},"Выбрать",-1)]),8,Qe)]),e("div",He,[e("div",Ke,[e("div",We,[e("div",Xe,[e("img",{src:t.icon,alt:t.title,class:"w-full h-full rounded-xl object-cover border border-light-border dark:border-gray-700/30 shadow-lg"},null,8,Ye),r[8]||(r[8]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-gray-900/60 to-transparent rounded-xl"},null,-1)),d(a(P),{class:"absolute bottom-2 right-2 w-4 h-4 text-purple-400"})]),e("div",null,[e("h3",Ze,s(t.title),1),e("p",et,s(t.artist),1)])])]),e("div",tt,[e("span",rt,s(t.genre.name),1)]),e("div",st,s(t.price)+" ₽ ",1),e("div",at,[e("button",{onClick:o=>I(t),class:"px-4 py-2 bg-purple-400/10 hover:bg-purple-400/20 border border-purple-400/30 rounded-lg transition-all group/btn"},r[9]||(r[9]=[e("span",{class:"text-purple-400 group-hover/btn:text-purple-300"},"Выбрать",-1)]),8,lt)])])]))),128))])])]))])]),d(R,{name:"fade"},{default:p(()=>{var t,o,g,_,w;return[T.value?(l(),u("div",ot,[e("div",dt,[e("h3",nt,s((t=b.value)==null?void 0:t.title)+" - "+s((o=b.value)==null?void 0:o.artist),1),e("form",{onSubmit:ne(ee,["prevent"]),class:"space-y-6"},[e("div",null,[r[11]||(r[11]=e("label",{class:"block text-light-text-secondary dark:text-gray-400 mb-2"},"Ваша цена",-1)),D(e("input",{type:"number","onUpdate:modelValue":r[2]||(r[2]=$=>h.value=$),min:((g=b.value)==null?void 0:g.price)||0,required:"",class:"w-full p-3.5 bg-light-bg dark:bg-gray-900/20 border text-light-text dark:text-white border-light-border dark:border-gray-700/30 rounded-xl focus:border-purple-400/50 focus:ring-2 focus:ring-purple-400/20 transition-all",placeholder:`Минимум ${(_=b.value)==null?void 0:_.price} ₽`},null,8,it),[[E,h.value,void 0,{number:!0}]])]),e("div",ut,[e("button",{type:"button",onClick:Z,class:"px-6 py-2.5 bg-light-bg dark:bg-gray-700/10 hover:bg-light-bg-secondary dark:hover:bg-gray-700/20 border border-light-border dark:border-gray-700/30 text-light-text-secondary dark:text-gray-400 rounded-xl transition-all"}," Отмена "),e("button",{type:"submit",disabled:k.value||h.value<(((w=b.value)==null?void 0:w.price)||0),class:"px-6 py-2.5 bg-gradient-to-r from-purple-600/30 to-blue-500/30 hover:from-purple-600/50 hover:to-blue-500/50 border border-purple-400/30 text-purple-400 rounded-xl transition-all disabled:opacity-50"},[k.value?(l(),v(a(J),{key:0,class:"w-5 h-5 mr-2 animate-spin inline"})):y("",!0),L(" "+s(k.value?"Обработка...":"Заказать"),1)],8,ct)])],32)])])):y("",!0)]}),_:1}),d(R,{name:"fade"},{default:p(()=>{var t,o,g,_,w,$;return[z.value?(l(),u("div",gt,[e("div",bt,[e("div",pt,[d(a(ye),{class:"w-12 h-12 text-green-400 mx-auto mb-4 animate-pulse"}),r[12]||(r[12]=e("h3",{class:"text-xl font-bold text-light-text dark:text-gray-200 mb-2"},"Запрос успешно создан!",-1))]),e("div",xt,[e("div",ht,[e("p",vt,s((t=c.value)==null?void 0:t.track.title),1),e("p",yt,s((o=c.value)==null?void 0:o.track.artist),1)]),e("div",mt,[e("div",ft,[r[13]||(r[13]=e("p",{class:"text-xs text-light-text-secondary dark:text-gray-400 mb-1"},"Ваша цена",-1)),e("p",kt,s((g=c.value)==null?void 0:g.user_fee)+" ₽",1)]),e("div",_t,[r[14]||(r[14]=e("p",{class:"text-xs text-light-text-secondary dark:text-gray-400 mb-1"},"Статус",-1)),e("span",{class:S([(_=c.value)!=null&&_.is_paid?"text-green-400":"text-amber-400","font-medium"])},s((w=c.value)!=null&&w.is_paid?"Оплачен":"Ожидает оплаты"),3)])])]),e("div",wt,[($=c.value)!=null&&$.is_paid?y("",!0):(l(),u("button",{key:0,onClick:te,class:"w-full py-2.5 bg-green-400/10 hover:bg-green-400/20 border border-green-400/30 text-green-400 rounded-xl transition-all"}," Перейти к оплате ")),e("button",{onClick:re,class:"w-full py-2.5 bg-light-bg dark:bg-gray-700/10 hover:bg-light-bg-secondary dark:hover:bg-gray-700/20 border border-light-border dark:border-gray-700/30 text-light-text-secondary dark:text-gray-400 rounded-xl transition-all"}," Закрыть ")])])])):y("",!0)]}),_:1})]))}});export{St as default};
